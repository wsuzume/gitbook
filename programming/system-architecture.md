# システムの構成

## サーバーの物理構成

サーバー自体は固定IPでインターネットから接続できるコンピュータであればなんでもよい。サービスを構成するネットワークは Docker によって仮想化してしまうので、サーバーは1台でもよいし複数台を用いてもよい。自身の経済状況やシステムの堅牢性を考慮して自由に設計してよい。

記事では作業の手軽さとコストパフォーマンスの兼ね合いから最初は

* ConoHa VPS 1GBプラン 1台

を使用するが、金銭的に余裕のある人は AWS, Azure, GCP といったクラウドサービスを利用するといくらか手間を省くことができるかもしれない。

## OSの選定

OSは **CentOS8** を用いる。理由は

1. サーバー用途で実績がある CentOS7 の後継
2. Python3 が標準となっている

の2点である。特に pure な Python3 で書かれた自動化スクリプトであればまったく環境を汚さずに実行できる点が非常にポイントが高い。

## 仮想化

サービスは **Docker** で構築された仮想環境で動作する。各コンポーネントをコンテナとして構成・配置することで、各コンポーネントが物理的にどのサーバー上にあるかは重要ではなくなる。

今回の構成を1台のサーバー上に置く場合は次のような配置になる。

\[画像\]

このシステムを商用サービスとして複数台のサーバーに再配置するには、たとえば次のようにすればよい。

\[画像\]

## リバースプロキシ

今回はシステム内に複数のWebサービスを配置可能な構成としているから、**nginx** をリバースプロキシとしてユーザにもっとも近い位置に配置してリクエストを各サービスに振り分けるように設定する。

また ConoHa VPS では AWS のような至れり尽くせりのリソース支援を受けられるわけではないので、SSL/TLS通信の設定を自分で行う必要があるが、リバースプロキシでSSLオフローディングの設定を行うことでAPIサーバーの側ではSSL/TLS通信を考慮しなくてよい設計になっている。

## APIサーバー（golang/gin）

APIサーバーがフロントエンドのUIも提供する。

## フロントエンド（Elm）



## DBサーバー（MySQL）



## KVS（Redis）



## FirebaseによるAuthentication

ユーザの認証には Google の Firebase を用いる。



