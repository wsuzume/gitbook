# 4.5. 準ニュートン法

## 準ニュートン法

準ニュートン法（quasi-Newton method）は Hesse 行列を勾配によって近似してニュートン法に近い形で最適化を行う手法である。

Broyden クラスに属する方法（DFP 法、BFGS 法、Broyden 法）は近似した Hesse 行列の逆行列を計算せねばならないという懸念は残るものの

1. Hesse 行列が陽な形で計算できない場合
2. Hesse 行列を直接計算するには計算量が大きくなる場合

には有効である。また、BFGS 法をうまく式変形した L-BFGS 法は逆行列の計算を回避できる上にその逆行列自体をメモリに保存しておく必要がないので、

* 高速
* 省メモリ
* 高精度

を達成しており、現代で大規模最適化問題を解く際の主流の方法となっている。

## 原理

ニュートン法の原理の説明のときに現れた 、2次近似した関数の極値への移動を表す \(4.3.6\) 式を再び以下に示す。

$$
\Delta x = - H _ {x ^ k} ^ {-1} \operatorname{grad} f (x ^ k) \tag{4.5.1}
$$

準ニュートン法ではこの$$H _ {x ^ k}$$またはその逆行列$$H _ {x ^ k} ^ {-1}$$の計算を回避したい。そこで$$H _ {x ^ k}$$を近似する正定値対称行列$$B _ k$$を導入して

$$
m ^ k = - B _ k ^ {-1} \operatorname{grad} f (x ^ k) \tag{4.5.2}
$$

とする。ニュートン法では更新方向$$m ^ k$$とステップサイズ$$\alpha ^ k$$を合わせた$$\Delta x = \alpha ^ k m ^ k$$が直接求まったが、準ニュートン法では Hesse 行列を近似したため、改めて$$\alpha ^ k$$を直線探索によって求める必要が生じる（Hesse 行列の近似がうまく行っていることを期待して最初は$$\alpha ^ k = 1$$で固定して試してみてもよい）。

$$B _ k$$を正定値行列に限ったのは、更新方向$$m ^ k$$が目的関数の降下方向であることを保証するためである（証明は最急降下法のページに記した）。

{% page-ref page="../gradient-descent.md" %}

$$B _ k$$の選び方には自由度がある。正定値行列は対称行列とは限らないが、Hesse 行列は常に対称行列なので$$B _ k$$には正定値対称行列が選ばれる。この条件をセカント条件という。この$$B _ k$$の選び方によって、これから紹介する DFP 法や BFGS 法といったバリエーションが生じる。

また、L-BFGS 法では$$B _ k$$を計算せずその逆行列を直接更新することが可能なので、$$H _ k = B _ k ^ {-1}$$とおいて

$$
m ^ k = - H _ k \operatorname{grad} f (x ^ k) \tag{4.5.3}
$$

とする。$$H _ k \approx H _ {x ^ k} ^ {-1}$$なので少々紛らわしいが、慣習的にそう置かれることが多いので容赦していただきたい（数学は常に文字不足に悩まされているのだ）。

## 収束性

準ニュートン法は超1次収束のアルゴリズムである。

